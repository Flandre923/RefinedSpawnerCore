# 向上流动魔法水测试指南

## 🧪 测试准备

### 环境要求
- Java 17或更新版本
- NeoForge 1.21.6
- 创造模式或管理员权限

### 获取测试物品
1. 打开创造模式物品栏
2. 搜索"Magic Water Bucket"或在"Example Mod Tab"中找到
3. 获取魔法水桶

## 🔬 基础测试

### 测试1: 基本向上流动
1. **位置**: 找一个开阔的平地
2. **操作**: 右键点击地面放置魔法水
3. **预期结果**:
   - 魔法水应该**直接向上流动**，不向四周扩散
   - 形成一个向上的"水柱"
   - 流体呈现紫色
   - 有微弱的发光效果

### 测试2: 高度限制测试
1. **位置**: 在不同高度放置魔法水
2. **操作**: 观察流体能流动到多高
3. **预期结果**: 
   - 流体强度随高度递减
   - 最终在某个高度停止流动

### 测试3: 障碍物测试
1. **位置**: 在魔法水上方放置方块
2. **操作**: 观察流体如何绕过障碍物
3. **预期结果**:
   - 流体遇到障碍物后**才**向侧面流动
   - 不能穿透固体方块
   - 侧面流动后如果上方空间打开，应该继续向上流动

## 🏗️ 高级测试

### 测试4: 多源流体测试
1. **设置**: 在附近放置多个魔法水源
2. **观察**: 流体如何相互作用
3. **预期**: 流体应该合并并增强向上流动

### 测试5: 与原版流体交互
1. **设置**: 在魔法水附近放置普通水
2. **观察**: 两种流体的交互
3. **预期**: 应该能够共存而不相互干扰

### 测试6: 容器测试
1. **设置**: 使用不同类型的容器（炼药锅等）
2. **操作**: 尝试收集向上流动的魔法水
3. **预期**: 应该能够正常收集

### 测试7: 优先级验证测试 🆕
1. **设置**: 在平地放置魔法水，确保上方和侧面都有空间
2. **操作**: 观察流体的初始流动方向
3. **预期结果**:
   - 流体应该**只**向上流动
   - **不应该**同时向侧面扩散
   - 只有在上方被阻挡时才向侧面流动

### 测试8: 阶梯测试 🆕
1. **设置**: 创建阶梯状的结构
2. **操作**: 在底部放置魔法水
3. **预期结果**:
   - 流体应该向上爬升阶梯
   - 而不是向下流动填充低处

### 测试9: 严格向上流动测试 🆕🔥
1. **设置**: 在完全开阔的平地放置魔法水（确保上方至少10格都是空气）
2. **操作**: 观察流体的流动模式
3. **预期结果**:
   - 流体应该**只**向上流动，形成一条直线
   - **绝对不应该**向四周扩散
   - 应该形成一个垂直的"水柱"

### 测试10: 阻挡触发侧面扩散测试 🆕🔥
1. **设置**: 在魔法水上方3-4格处放置一个方块
2. **操作**: 观察流体到达障碍物时的行为
3. **预期结果**:
   - 流体向上流动直到遇到障碍物
   - **只有在遇到障碍物时**才开始向侧面扩散
   - 如果移除障碍物，侧面的流体应该重新向上流动

### 测试11: 流动距离测试 🆕🔥
1. **设置**: 在完全开阔的空间放置魔法水
2. **操作**: 测量流体能向上流动的最大高度
3. **预期结果**:
   - 流体应该能流动到**至少6-8格**高度
   - 不应该在2-3格就停止
   - 强度应该逐渐递减但保持流动

### 测试12: 基本消散机制测试 🆕🔥
1. **设置**: 放置魔法水源，等待流动稳定
2. **操作**: 移除源方块，观察流体消散
3. **预期结果**:
   - 移除源方块后，所有流体应该**逐渐消散**
   - 流体应该从上往下或从远到近消失
   - **不应该**永久存在

### 测试13: 级联消散测试 🆕🔥🔥
1. **设置**: 放置魔法水源，让它向上流动形成长链（6-8格高）
2. **操作**: 移除源方块，仔细观察消散过程
3. **预期结果**:
   - **所有流体**都应该最终消散，包括最顶端的流体
   - 消散应该是**级联式**的：下层消散触发上层消散
   - **不应该**有任何流体永久残留

### 测试14: 复杂网络消散测试 🆕🔥🔥
1. **设置**: 创建复杂的流体网络（T型、L型结构）
2. **操作**: 移除源方块，观察整个网络的消散
3. **预期结果**:
   - **整个网络**都应该完全消散
   - 不应该有任何"孤岛"流体残留
   - 消散过程应该在合理时间内完成

### 测试15: 时间延迟消散测试 🆕🔥🔥🔥
1. **设置**: 放置魔法水源，等待流体完全稳定
2. **操作**:
   - 等待30-60秒让流体进入"稳定"状态
   - 然后移除源方块
   - 观察消散过程
3. **预期结果**:
   - **即使等待很长时间**，移除源头后流体仍应该消散
   - 消散行为应该与立即移除时**完全一致**
   - 不应该有任何流体永久残留

### 测试16: 多次延迟测试 🆕🔥🔥🔥
1. **设置**: 重复进行延迟消散测试
2. **操作**:
   - 测试不同的等待时间（10秒、30秒、60秒、120秒）
   - 每次都观察消散效果
3. **预期结果**:
   - **所有测试**的消散行为应该保持一致
   - 等待时间不应该影响消散效果
   - 每次都应该完全消散

## 🎮 游戏体验测试

### 测试7: 玩家交互
1. **游泳测试**: 在魔法水中游泳
2. **溺水测试**: 确认仍然可以溺水
3. **推力测试**: 感受负密度的推力效果

### 测试8: 实体交互
1. **物品掉落**: 将物品扔入魔法水
2. **生物行为**: 观察生物在魔法水中的行为
3. **船只测试**: 在魔法水中使用船只

### 测试9: 功能性测试
1. **灭火测试**: 用魔法水扑灭火焰
2. **农作物测试**: 测试是否能水合农作物
3. **红石交互**: 测试与红石设备的交互

## 🐛 问题排查

### 常见问题及解决方案

#### 问题1: 流体不向上流动
**可能原因**:
- 密度设置不正确
- spread方法未正确重写
- 上方有阻挡物

**检查方法**:
```java
// 确认FluidType中的密度设置
.density(-1000) // 应该是负值
```

#### 问题2: 流体消失
**可能原因**:
- 流体状态计算错误
- 没有足够的源流体
- 流动逻辑有bug

**检查方法**:
- 确保有足够的源方块
- 检查getNewLiquidForUpwardFlow方法

#### 问题3: 性能问题
**可能原因**:
- 向上流动计算过于频繁
- 流体更新范围过大

**优化方法**:
- 调整tick延迟
- 限制流动高度

#### 问题4: 视觉效果异常
**可能原因**:
- 客户端扩展未正确注册
- 纹理文件缺失

**检查方法**:
- 确认RegisterClientExtensionsEvent正确触发
- 检查纹理文件路径

## 📊 测试记录模板

### 基础信息
- **测试日期**: ___________
- **游戏版本**: Minecraft 1.21.6
- **模组版本**: ___________
- **测试环境**: 创造模式/生存模式

### 测试结果
| 测试项目 | 预期结果 | 实际结果 | 通过/失败 | 备注 |
|---------|---------|---------|----------|------|
| 基本向上流动 | 流体向上 | | | |
| 高度限制 | 逐渐减弱 | | | |
| 障碍物绕行 | 侧面流动 | | | |
| 多源合并 | 流体合并 | | | |
| 玩家交互 | 正常游泳 | | | |
| 功能性 | 灭火/水合 | | | |

### 发现的问题
1. ________________________________
2. ________________________________
3. ________________________________

### 改进建议
1. ________________________________
2. ________________________________
3. ________________________________

## 🎯 成功标准

测试通过的标准：
- ✅ 魔法水能够稳定向上流动
- ✅ 流体具有正确的视觉效果（紫色、发光）
- ✅ 玩家可以正常与流体交互
- ✅ 流体保持所有基本功能（灭火、水合等）
- ✅ 性能表现良好，无明显卡顿
- ✅ 与其他游戏元素兼容

## 📝 反馈收集

如果在测试过程中发现问题，请记录：
1. **具体操作步骤**
2. **预期结果 vs 实际结果**
3. **错误信息（如有）**
4. **复现条件**
5. **建议的修复方案**

这将帮助进一步优化向上流动的实现！
